# 選択肢を選んで送信する（ドロップダウン） 03

## ドロップダウン 初期選択状態のコントロール

ComboBoxで作成される選択肢は、デフォルトで以下の様な動作をする。

1. 最初に表示された時は `選んでください` という表示と、選択肢を表示する。`選んでください` のまま送信すると `null` が送られる
2. 選択肢を選ぶと `選んでください` が消え、選択肢だけになる。

この時、以下のような要望に対応しないといけない場合がある。

- 最初から、何かが選ばれている状態にしてほしい
- 選択肢を選んだ後も、何も選ばない状態に戻せるようにしたい

これを実現する方法はいくつかあるが、代表的な対処法を例示する。

### A.最初から何かが選ばれている状態にしてほしい

DropDownChoiceの中で、 **選択したものを入れるためのModel (selectedModel) の中身をあらかじめ準備** しておく。

#### PullDownPage.java

下の例は、選択肢のうち最初のインスタンスをselectedModelに入れておくComboBoxのコード例である。

```java
package com.example.vsbp.page;

import com.example.vsbp_demo.data.AuthUser;
import com.example.vsbp_demo.service.IUserService;
import com.vaadin.flow.component.button.Button;
import com.vaadin.flow.component.combobox.ComboBox;
import com.vaadin.flow.component.html.H1;
import com.vaadin.flow.component.html.H2;
import com.vaadin.flow.component.notification.Notification;
import com.vaadin.flow.component.orderedlayout.HorizontalLayout;
import com.vaadin.flow.component.orderedlayout.VerticalLayout;
import com.vaadin.flow.component.select.Select;
import com.vaadin.flow.router.Route;
import com.vaadin.flow.server.auth.AnonymousAllowed;

import java.util.Optional;

@AnonymousAllowed
@Route("PullDown")
public class PullDownPage extends VerticalLayout {

    private final IUserService userService;

    public PullDownPage(IUserService userService) {
        this.userService = userService;

        var top = new H1("プルダウンメニューによる選択");
        var title = new H2("このシステムに登録されているユーザ一の一覧");
        var selectedModel = userService.findAuthUsers();

        // ComboBoxでの例
        ComboBox<AuthUser> select = new ComboBox<>();
        select.setPlaceholder("選んでください");
        select.setItems(selectedModel);

        //ドロップダウンに表示されるラベルの指定
        select.setItemLabelGenerator(AuthUser::userName);

        // ドロップダウンメニューの初期値設定
        Optional.ofNullable(selectedModel)
                .ifPresent(user ->
                        select.setValue(selectedModel.getFirst()));

        // 未選択時の注記処理
        select.setRequiredIndicatorVisible(true);
        select.setI18n(new ComboBox.ComboBoxI18n()
                .setRequiredErrorMessage("選択してください"));

        var sendButton = new Button("送信");
        sendButton.addClickListener(clickEvent -> {
            // 空の時に送信処理中断
            if (select.getValue() == null) {
                Notification.show("ドロップダウンで選択してください");
                return;
            }
            System.out.println(select.getValue());
        });

        var selectHorizontalLayout = new HorizontalLayout(select, sendButton);

        add(top, title, selectHorizontalLayout);
    }
}
```

### B.選択肢を選んだ後も、何も選ばない状態に戻したい

ComboBoxの中で、必ず空欄の選択肢を用意するように設定する。

このためには、 **setClearButtonVisble メソッドを利用** する。

#### PullDownPage.java

```java
package com.example.vsbp.page;

import com.example.vsbp_demo.data.AuthUser;
import com.example.vsbp_demo.service.IUserService;
import com.vaadin.flow.component.button.Button;
import com.vaadin.flow.component.combobox.ComboBox;
import com.vaadin.flow.component.html.H1;
import com.vaadin.flow.component.html.H2;
import com.vaadin.flow.component.notification.Notification;
import com.vaadin.flow.component.orderedlayout.HorizontalLayout;
import com.vaadin.flow.component.orderedlayout.VerticalLayout;
import com.vaadin.flow.component.select.Select;
import com.vaadin.flow.router.Route;
import com.vaadin.flow.server.auth.AnonymousAllowed;

import java.util.Optional;

@AnonymousAllowed
@Route("PullDown")
public class PullDownPage extends VerticalLayout {

    private final IUserService userService;

    public PullDownPage(IUserService userService) {
        this.userService = userService;

        var top = new H1("プルダウンメニューによる選択");
        var title = new H2("このシステムに登録されているユーザ一の一覧");
        var selectedModel = userService.findAuthUsers();

        // ComboBoxでの例
        ComboBox<AuthUser> select = new ComboBox<>();
        select.setPlaceholder("選んでください");
        select.setItems(selectedModel);

        // 何も選択していない状態に戻す手法
        select.setClearButtonVisible(true);

        //ドロップダウンに表示されるラベルの指定
        select.setItemLabelGenerator(AuthUser::userName);

        // ドロップダウンメニューの初期値設定
        Optional.ofNullable(selectedModel)
                .ifPresent(user ->
                        select.setValue(selectedModel.getFirst()));

        // 未選択時の注記処理
        select.setRequiredIndicatorVisible(true);
        select.setI18n(new ComboBox.ComboBoxI18n()
                .setRequiredErrorMessage("選択してください"));

        var sendButton = new Button("送信");
        sendButton.addClickListener(clickEvent -> {
            // 空の時に送信処理中断
            if (select.getValue() == null) {
                Notification.show("ドロップダウンで選択してください");
                return;
            }
            System.out.println(select.getValue());
        });

        var selectHorizontalLayout = new HorizontalLayout(select, sendButton);

        add(top, title, selectHorizontalLayout);
    }
}
```

`setClearButtonVisible(true);` を設定し、また `setPlaceholder()` メソッドで、表示用の文字列を設定できる。

---

[目次へ](../../README.md)
