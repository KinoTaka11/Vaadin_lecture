# ユーザ認証 課題

## 課題1

`UserMakerPage`から、ロールを含めた新規ユーザの作成を行えるようにしなさい。<br>

※ユーザのロールは`ROLE_権限名`の形式で入力する。(例：ROLE_ADMIN)

ヒント
- 変更、追加を加えるべきページは以下の通り。

  - `IAuthoritiesRepository`,`AuthoritiesRepository`：DBへのロール登録をどう行うか？

  - `IUserService`,`UserService`：レポジトリを使ってどうDBへの登録を行うか？

  - `UserMakerPage` ：サービスとフォームに入力された値を使ってどうDBへの登録を行うか？

上記の三層アーキテクチャを意識すると構造を把握しやすし。


<br>

課題ができたら、以下を確認する。

- exampleadmin でサインインし、`UserMakerPage`で適当なユーザを作成する。

  - このとき、`UserRole`のフィールドは、`ROLE_権限名`の形式で入力する。(例：ROLE_ADMIN)

  - これは`@RolesAllowed`で識別する際に、権限名に`ROLE_`というプレフィックスが必要だからである。

  - 興味がある人は、この辺の入力を簡略化するように工夫をしてみることもよい。(後で出てくるドロップダウンを使うのも手)

  - 登録が完了したら、サインアウトしてから作成したユーザでサインインし、認証・認可が機能することを確認する。

<br>

## その他について

現状では、認証機能自体は完成したが不完全な部分も多い。<br>

- ユーザ追加時に同じユーザ名を追加するとExceptionが出る。(例外処理がない)

- ユーザ削除時は存在しないユーザを入力しても（表示上）ユーザが消えたことになる。

- ユーザのロール入力について、バリデータがない。（不正なROLEを受け付けてしまう）

  - そもそも、`ROLE_ ` を頭につけさせるという、システムの都合でユーザに面倒な操作をさせている。

- アクセス権限のないページに飛んだ時用のページがない。
- データベースに保存されるパスワードがハッシュ化されていない。

など様々な問題点が浮かんでくる。興味のある人は [こちら](./補足.md) を参考にしたり、自分で調べたりして改善してみよう。 

[目次へ戻る](../README.md)  &emsp;&emsp;[前の項目へ](./06.md) &emsp;&emsp;[次の項目へ](../コンポDB/01.md)
