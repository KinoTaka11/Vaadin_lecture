# 環境設定

## Spring Bootのプロジェクトを作成する。

[Spring Initializr](https://start.spring.io/) アクセスする。

- Project を `maven` にする
- Language を `Java` にする
- Spring Boot を `3.3.x` の最新版（xは、時期によって変わる。SNAPSHOTは除く）
- Artifact を `vsbp` にする
- Java を `21` にする
- Search for dependencies に `JDBC` を入力し、 `JDBC API` を選択
- Search for dependencies に `h2` を入力し、 `H2 Database` を選択
- Search for dependencies に `Post` を入力し、 `PostgreSQL Driver` を選択
- Search for dependencies に `Vaadin` を入力し、 `Vaadin` を選択
- Search for dependencies に `Spring` を入力し、 `Spring Security` を選択

画像は最新版でない可能性があるので、上記の情報をもとにプロジェクトを作成してください。
![環境設定_1](../images/環境設定_1.png)

Generateボタンを押して、vsbp.zipファイルをダウンロードする。
ダウンロードした vsbp.zip は展開する。

## IDEでプロジェクトを読み込む
intellij IDEAの場合
- ファイル > 開く で、vsbp.zipを展開したフォルダ内のpom.xmlを選択する。
- Mavenプロジェクトを自動的にインポートする(import Maven projects automatically)にチェックして続行。

## pom.xmlファイルを編集する
生成したSpring Bootプロジェクトは、 Maven というプロジェクト管理ツールで作られる。

Mavenの設定ファイル **pom.xml** が、 IntelliJ に読み込んだwsbpプロジェクトにも存在しているので、これを変更する。変更する箇所が多いので注意。

変更ミスがあると、うまく動かない原因になるので、スペルミスなどが怖い時はコピペ推奨。


### 1 `<version>...</version>` を削除し、 `<packaging>...</packaging>` を追加する

書き換え前

```xml
<groupId>com.example</groupId>
<artifactId>vsbp</artifactId>
<version>0.0.1-SNAPSHOT</version>
<name>vsbp</name>
```

書き換え後

```xml
<groupId>com.example</groupId>
<artifactId>vsbp</artifactId>
<name>vsbp</name>
<packaging>war</packaging>
```

- ここの **`<version>0.0.1-SNAPSHOT</version>` を削除** し、`<packaging>war</packaging>` を足していることに注意！

### 2 `<properties>...</properties>` にプロジェクト設定、実行形式ファイル名への日時形式を挿入する

書き換え前

```xml
<properties>
		<java.version>21</java.version>
		<vaadin.version>24.5.8</vaadin.version>
</properties>
```

書き換え後（java.version , vaadin.versionは元々のままにし、それ以下を付け足す）

```xml
<properties>
  <java.version>21</java.version>
  <!-- プロジェクトでは基本的にUTF-8を使う -->
  <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
  <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
  <!-- 実行形式ファイル名につける日時の形式を指定する -->
  <maven.build.timestamp.format>yyyyMMdd-HHmmss</maven.build.timestamp.format>
</properties>
```

### 3 `<dependencies>...</dependencies>` に wicket-spring-boot-starter を挿入する

書き換え前

```xml
<dependencies>
  <dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jdbc</artifactId>
  </dependency>

  <!-- 以下省略 -->

</dependencies>
```

書き換え後（　**「Wicket-Spring-Bootを使う」部分** が一番最初のdependencyになるように挿入する）

```xml
<dependencies>
  <!-- Wicket-Spring-Bootを使う -->
  <dependency>
    <groupId>com.giffing.wicket.spring.boot.starter</groupId>
    <artifactId>wicket-spring-boot-starter</artifactId>
  </dependency>
  <dependency>
    <groupId>org.wicketstuff</groupId>
    <artifactId>wicketstuff-annotation</artifactId>
  </dependency>

  <!-- 以下からは元のまま -->
  <dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-jdbc</artifactId>
  </dependency>
  
  <!-- 以下省略 -->
  
</dependencies>
```

- **`<dependencies>` の開始直後に、 wicket-spring-boot-starter と　wicketstuff-annotation の　`<dependency>...</dependency>` を追加する**ことに注意！
- spring-boot-starter-jdbc 以下の `<dependency>...</dependency>` はそのまま残す。

### 4 `<build>...</build>` を書き換える

#### 4-1 実行形式ファイル名 `<finalName>...</finalName>` と `<configuration>...</configuration>` を追加する

- filename ではなく **final**name であることに注意。

変更前

```xml
<build>
  <plugins>
    <plugin>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-maven-plugin</artifactId>
    </plugin>
  </plugins>
</build>
```

変更後

```xml
<build>
  <!-- 実行形式ファイル名を設定する -->
  <finalName>${project.artifactId}-${maven.build.timestamp}</finalName>
  <plugins>
    <plugin>
      <groupId>org.springframework.boot</groupId>
      <artifactId>spring-boot-maven-plugin</artifactId>
      　<!-- Spring-Bootプロジェクトを、executable-warとしてビルドする -->
        <configuration>
          <executable>true</executable>
        </configuration>
    </plugin>
  </plugins>
</build>
```

#### 4-2 HTMLファイルをクラスパスに組み込めるようにする `<resources>...</resources>`

変更前

```xml
<build>
  <!-- 実行形式ファイル名を設定する -->
　<finalName>${project.artifactId}-${maven.build.timestamp}</finalName>
  <plugins>
    <!-- 中略 -->  
  </plugins>
</build>
```

変更後

- つまり、**`<plugins>...</plugins>` の直後に、`<resources>...</resources>` を追加する**ことに注意！

```xml
<build>
  <!-- 実行形式ファイル名を設定する -->
  <finalName>${project.artifactId}-${maven.build.timestamp}</finalName>
  <plugins>
    <!-- 中略 -->
  </plugins>

  <!-- ビルドの際に、htmlファイルをクラスフォルダに含める -->
  <resources>
    <resource>
      <directory>src/main/resources</directory>
    </resource>
    <resource>
      <directory>src/main/java</directory>
      <includes>
        <include>**</include>
      </includes>
      <excludes>
        <exclude>**/*.java</exclude>
      </excludes>
    </resource>
  </resources>
</build>
```
